<!DOCTYPE html>
<html>
  <head>
    <title>我的个人管理</title>
    <link rel="stylesheet" href="style.css" />
    <!-- marked.js用于Markdown解析 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- 环境变量配置 -->
    <script>
      window.ENV = {
        SUPABASE_URL: 'https://gptacdyjxmjzlmgwjmms.supabase.co',
        SUPABASE_KEY: '<%=process.env.VITE_SUPABASE_KEY%>', // 将被build.js替换
      }
    </script>
  </head>
  <body>
    <!-- 登录面板 -->
    <div id="loginPanel" class="login-panel">
      <div class="login-box">
        <h2>请输入访问密码</h2>
        <p class="login-tip">登录后将自动保存到当前浏览器</p>
        <div class="login-form">
          <input type="password" id="password" placeholder="输入密码" />
          <button
            onclick="authenticate(document.getElementById('password').value)"
          >
            确认
          </button>
        </div>
      </div>
    </div>

    <!-- 主要内容区域 -->
    <div id="mainContent" class="app-container">
      <!-- 左侧笔记列表 -->
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="header-top">
            <h2>笔记列表</h2>
            <button onclick="logout()" class="logout-btn">退出</button>
          </div>
          <button id="newNoteBtn" class="new-note-btn">新建笔记</button>
        </div>
        <div id="notesList" class="notes-list">
          <!-- 笔记标题列表将在这里动态显示 -->
        </div>
      </div>

      <!-- 主要内容区域 -->
      <div class="main-content">
        <div class="note-editor" id="noteEditor">
          <div class="note-toolbar">
            <input
              type="text"
              id="noteTitle"
              placeholder="笔记标题"
              class="title-input"
            />
            <button id="saveButton" class="save-btn">保存</button>
          </div>
          <div class="editor-container">
            <textarea
              id="noteContent"
              placeholder="在此输入笔记内容... (支持Markdown语法)"
            ></textarea>
            <div id="preview" class="preview-panel">
              <!-- Markdown预览将在这里显示 -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import * as NoteApp from './app.js'
      document
        .getElementById('saveButton')
        .addEventListener('click', NoteApp.saveNote)
      document
        .getElementById('newNoteBtn')
        .addEventListener('click', NoteApp.createNewNote)
      document
        .getElementById('noteContent')
        .addEventListener('input', NoteApp.updatePreview)

      // 支持Enter键登录
      document.getElementById('password').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          NoteApp.authenticate(e.target.value)
        }
      })
    </script>
  </body>
</html>
